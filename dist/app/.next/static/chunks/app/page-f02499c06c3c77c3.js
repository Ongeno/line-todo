(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4022:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(5155),o=s(2115),l=s(5453),n=s(832),a=s.n(n);let i={nodes:[],view:"week",selectedNode:null,scale:1,startDate:a()().subtract(3,"month").toDate(),endDate:a()().add(3,"month").toDate(),loading:!1,error:null},d=(0,l.v)(e=>{let t=null,s=0;return{...i,fetchNodes:async()=>{let r=Date.now();if(t&&r-s<3e4){console.log("使用缓存的节点数据，避免频繁刷新"),e({nodes:t.map(e=>{if(e.id){let t=localStorage.getItem("node-position-".concat(e.id));if(t)try{e={...e,titleOffset:JSON.parse(t)}}catch(e){console.error("解析本地存储位置信息失败:",e)}}return e}),loading:!1});return}e({loading:!0,error:null});try{let o=await fetch("/api/nodes");if(!o.ok)throw Error("Failed to fetch nodes");let l=(await o.json()).map(e=>{let t={...e,id:e.id||crypto.randomUUID()};if(t.id){let e=localStorage.getItem("node-position-".concat(t.id));if(e)try{t.titleOffset=JSON.parse(e)}catch(e){console.error("解析本地存储位置信息失败:",e)}}return t.titleOffset||(t.titleOffset={x:0,y:0}),t});t=l,s=r,e({nodes:l,loading:!1})}catch(t){e({error:t.message,loading:!1})}},loadSettings:async()=>{try{let t=await fetch("/api/timeline-settings");if(!t.ok)throw Error("Failed to load timeline settings");let s=await t.json();s&&e({startDate:new Date(s.startDate),endDate:new Date(s.endDate)})}catch(e){console.error("加载时间轴设置失败:",e)}},addNode:async t=>{e({loading:!0,error:null});try{let s={...t,id:t.id||crypto.randomUUID()},r=await fetch("/api/nodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw Error("Failed to add node");let o=await r.json();e(e=>({nodes:[...e.nodes,o],loading:!1}))}catch(t){throw e({error:t.message,loading:!1}),t}},updateNode:async t=>{e({loading:!0,error:null});try{let s=await fetch("/api/nodes",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error("Failed to update node");let r=await s.json();e(e=>({nodes:e.nodes.map(e=>e.id===t.id?r:e),loading:!1}))}catch(t){e({error:t.message,loading:!1})}},deleteNode:async t=>{e({loading:!0,error:null});try{if(!(await fetch("/api/nodes/".concat(t),{method:"DELETE"})).ok)throw Error("Failed to delete node");e(e=>({nodes:e.nodes.filter(e=>e.id!==t),loading:!1}))}catch(t){e({error:t.message,loading:!1})}},addTodo:async(t,s)=>{e({loading:!0,error:null});try{let r=await fetch("/api/todos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw Error("Failed to add todo");let o=await r.json();e(e=>({nodes:e.nodes.map(e=>e.id===t?{...e,todos:[...e.todos,o]}:e),loading:!1}))}catch(t){e({error:t.message,loading:!1})}},updateTodo:async t=>{e({loading:!0,error:null});try{let s=await fetch("/api/todos",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error("Failed to update todo");let r=await s.json();e(e=>({nodes:e.nodes.map(e=>e.id===t.nodeId?{...e,todos:e.todos.map(e=>e.id===t.id?r:e)}:e),loading:!1}))}catch(t){e({error:t.message,loading:!1})}},deleteTodo:async t=>{e({loading:!0,error:null});try{if(!(await fetch("/api/todos?id=".concat(t),{method:"DELETE"})).ok)throw Error("Failed to delete todo");e(e=>({nodes:e.nodes.map(e=>({...e,todos:e.todos.filter(e=>e.id!==t)})),loading:!1}))}catch(t){e({error:t.message,loading:!1})}},setView:t=>e({view:t}),setScale:t=>e({scale:t}),setDateRange:async(t,s)=>{e({startDate:t,endDate:s});try{(await fetch("/api/timeline-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({startDate:t,endDate:s})})).ok||console.error("保存时间轴设置失败")}catch(e){console.error("保存时间轴设置出错:",e)}},setSelectedNode:t=>e({selectedNode:t})}});var c=s(470);function m(e){let{nodeId:t,todos:s,onClose:l}=e,[n,a]=(0,o.useState)(""),{addTodo:i,updateTodo:c,deleteTodo:m}=d(),u=async()=>{if(!n.trim())return;let e={id:crypto.randomUUID(),nodeId:t,text:n.trim(),completed:!1};await i(t,e),a("")},x=async e=>{await c({...e,completed:!e.completed})},g=async e=>{await m(e)};return(0,r.jsxs)("div",{className:"absolute left-0 top-full mt-2 w-96 rounded-lg bg-white p-4 shadow-lg",children:[(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"待办事项"}),(0,r.jsx)("button",{onClick:l,className:"text-gray-900 hover:text-gray-700",children:"\xd7"})]}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:n,onChange:e=>a(e.target.value),onKeyPress:e=>"Enter"===e.key&&u(),placeholder:"添加新的待办事项...",className:"flex-1 rounded border border-gray-300 px-3 py-2 text-sm text-gray-900 focus:border-blue-500 focus:outline-none"}),(0,r.jsx)("button",{onClick:u,className:"rounded bg-blue-500 px-3 py-2 text-sm text-white hover:bg-blue-600",children:"添加"})]})}),(0,r.jsx)("ul",{className:"space-y-2",children:s.map(e=>(0,r.jsxs)("li",{className:"flex items-center justify-between rounded bg-gray-50 p-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:e.completed,onChange:()=>x(e),className:"h-4 w-4 rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),(0,r.jsx)("span",{className:"text-sm ".concat(e.completed?"text-gray-400 line-through":"text-gray-900"),children:e.text})]}),(0,r.jsx)("button",{onClick:()=>g(e.id),className:"text-gray-900 hover:text-red-500",children:"\xd7"})]},e.id))})]})}function u(e){let{isOpen:t,onClose:s,onSubmit:l,onDelete:n,initialData:i}=e,[d,c]=(0,o.useState)(i);return t?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"".concat(i.id?"w-[1600px]":"w-[800px]"," rounded-lg bg-white shadow-xl"),children:[(0,r.jsx)("div",{className:"border-b border-gray-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:i.id?"编辑节点":"新建节点"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:a()(d.date).format("YYYY年MM月DD日")})]}),(0,r.jsx)("button",{type:"button",onClick:s,className:"text-gray-400 hover:text-gray-500",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l(d)},children:[(0,r.jsxs)("div",{className:"space-y-4 px-6 py-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-900",children:"标题"}),(0,r.jsx)("input",{type:"text",id:"title",value:d.title,onChange:e=>c({...d,title:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-900",children:"日期"}),(0,r.jsx)("input",{type:"date",id:"date",value:d.date.split("T")[0],onChange:e=>c({...d,date:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-900",children:"类型"}),(0,r.jsxs)("select",{id:"type",value:d.type,onChange:e=>c({...d,type:e.target.value}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500",required:!0,children:[(0,r.jsx)("option",{value:"normal",children:"普通节点"}),(0,r.jsx)("option",{value:"milestone",children:"里程碑"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-900",children:"描述"}),(0,r.jsx)("textarea",{id:"description",value:d.description,onChange:e=>c({...d,description:e.target.value}),rows:3,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[i.id?(0,r.jsx)("button",{type:"button",onClick:()=>{i.id&&confirm("确定要删除这个节点吗？")&&(n(),s())},className:"rounded-md border border-red-300 bg-white px-3 py-2 text-sm font-medium text-red-700 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"删除"}):(0,r.jsx)("div",{}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{type:"button",onClick:s,className:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-900 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"取消"}),(0,r.jsx)("button",{type:"submit",className:"rounded-md bg-blue-600 px-3 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"保存"})]})]})})]})]})}):null}function x(e){let{node:t,position:s}=e,[l,n]=(0,o.useState)(!1),[a,i]=(0,o.useState)(!1),[x,g]=(0,o.useState)(!1),h=(0,o.useRef)(null),[f,p]=(0,o.useState)(()=>{let e={x:0,y:0};if(t.id){let s=localStorage.getItem("node-position-".concat(t.id));if(s)try{e=JSON.parse(s)}catch(e){console.error("Failed to parse saved position:",e)}else t.titleOffset&&(e=t.titleOffset)}return h.current=e,e}),[y,b]=(0,o.useState)({x:0,y:0}),[v,j]=(0,o.useState)(!1),w=(0,o.useRef)(null),N=(0,o.useRef)(null),k=(0,o.useRef)(null),{updateNode:S,deleteNode:C}=d();(0,o.useEffect)(()=>{let e=e=>{w.current&&!w.current.contains(e.target)&&(n(!1),i(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,o.useEffect)(()=>{let e=()=>{let e,t,s,r;if(!w.current||!N.current||!k.current)return;let o=w.current.querySelector(".node-circle")||w.current.querySelector('div[role="node"]'),l=null==o?void 0:o.getBoundingClientRect(),n=N.current.getBoundingClientRect(),a=k.current.getBoundingClientRect();if(!l)return;let i=l.left+l.width/2-a.left,d=l.top+l.height/2-a.top,c=n.left+n.width/2-a.left,m=n.top+n.height/2-a.top;n.bottom<l.top?(e=c,t=n.bottom-a.top,s=i,r=d-(d-t)*.7):n.top>l.bottom?(e=c,t=n.top-a.top,s=i,r=d+(t-d)*.7):n.right<l.left?(e=n.right-a.left,t=m,r=d,s=i-(i-e)*.7):(e=n.left-a.left,t=m,r=d,s=i+(e-i)*.7);let u="M ".concat(i," ").concat(d," L ").concat(s," ").concat(r," L ").concat(e," ").concat(t),x=k.current.querySelector("path");x&&x.setAttribute("d",u)};if(e(),window.addEventListener("resize",e),x){let t=()=>{requestAnimationFrame(e)};return document.addEventListener("mousemove",t),()=>{document.removeEventListener("mousemove",t),window.removeEventListener("resize",e)}}return()=>{window.removeEventListener("resize",e)}},[x,f]),(0,o.useEffect)(()=>{let e=e=>{if(!x)return;let t=e.clientX-y.x,s=e.clientY-y.y;p(e=>({x:e.x+t,y:e.y+s})),b({x:e.clientX,y:e.clientY})},s=()=>{if(g(!1),t.id&&h.current){let e=Math.abs(f.x-h.current.x),s=Math.abs(f.y-h.current.y);e>5||s>5?(console.log("卡片位置发生明显变化，保存到localStorage"),localStorage.setItem("node-position-".concat(t.id),JSON.stringify(f)),j(!0)):p(h.current)}};return x&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",s)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s)}},[x,y.x,y.y,f.x,f.y,t.id]),(0,o.useEffect)(()=>{v&&t.id&&localStorage.setItem("node-position-".concat(t.id),JSON.stringify(f))},[v,t.id,f.x,f.y]),(0,o.useEffect)(()=>{let e=()=>{if(v&&t.id)try{localStorage.setItem("node-position-".concat(t.id),JSON.stringify(f))}catch(e){console.error("保存位置失败:",e)}};return()=>{e()}},[v,t.id,f.x,f.y]);let E=t.todos.length?t.todos.filter(e=>e.completed).length/t.todos.length*100:0,D=async e=>{try{e.title!==t.title||e.date!==t.date||e.type!==t.type||e.description!==t.description?await S({...t,...e,titleOffset:f}):console.log("节点内容未变化，不更新服务器数据"),t.id&&localStorage.setItem("node-position-".concat(t.id),JSON.stringify(f)),j(!1),i(!1)}catch(e){console.error("更新节点失败:",e),i(!1)}},L=async()=>{try{if(!t.id){console.error("Node ID is missing");return}await C(t.id),i(!1)}catch(e){console.error("Failed to delete node:",e),alert("删除节点失败，请稍后重试")}};return(0,r.jsxs)(c.P.div,{ref:w,className:"absolute top-1/2 -translate-x-1/2",style:{left:"".concat(s,"%")},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[(0,r.jsx)("svg",{ref:k,className:"absolute left-0 top-0 pointer-events-none",style:{width:"100%",height:"100%",position:"absolute",zIndex:-1,overflow:"visible"},children:(0,r.jsx)("path",{d:"",fill:"none",stroke:"#94a3b8",strokeWidth:"1.5",strokeDasharray:"4 2"})}),"milestone"===t.type?(0,r.jsxs)("div",{role:"node",className:"relative h-8 w-8 cursor-pointer transition-transform duration-200 hover:scale-110 z-10 flex items-center justify-center",onClick:()=>n(!l),children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-8 w-8 filter drop-shadow-md ".concat(100===E?"text-green-500":"text-yellow-500"),fill:"currentColor",style:{color:100===E?"#10b981":void 0},children:(0,r.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center ".concat(100===E?"text-green-700":"text-yellow-800"),style:{opacity:E/100,color:100===E?"#047857":void 0},children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"h-8 w-8",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})})]}):(0,r.jsx)("div",{className:"node-circle relative h-5 w-5 cursor-pointer rounded-full border-2 border-gray-300 transition-transform duration-200 hover:scale-110 z-10",onClick:()=>n(!l),children:(0,r.jsx)("div",{className:"absolute inset-0 rounded-full ".concat(E<30?"bg-red-500":E<100?"bg-yellow-500":"bg-green-500"),style:{opacity:E/100}})}),(0,r.jsx)("div",{ref:N,onMouseDown:e=>{e.stopPropagation(),g(!0),b({x:e.clientX,y:e.clientY})},className:"absolute left-1/2 -translate-x-1/2 cursor-move select-none z-10 ".concat("milestone"===t.type?"font-bold":""),style:{transform:"translate(".concat(f.x,"px, ").concat(f.y,"px)"),transition:x?"none":"transform 0.2s ease-out"},children:(0,r.jsxs)("div",{className:"group relative rounded px-2 py-1 text-sm font-medium text-gray-900 shadow-sm whitespace-nowrap ".concat("milestone"===t.type?100===E?"bg-green-50 ring-2 ring-green-300":"bg-yellow-50 ring-2 ring-yellow-300":"bg-white ring-1 ring-gray-200"),children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("span",{children:t.title}),(0,r.jsx)("span",{className:"text-xs text-gray-900",children:t.date.split("T")[0]})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),i(!0)},className:"absolute -right-2 -top-2 hidden text-gray-400 hover:text-gray-600 group-hover:block",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]})}),l&&(0,r.jsx)("div",{className:"absolute left-1/2 top-full mt-4 -translate-x-1/2",children:(0,r.jsx)(m,{nodeId:t.id,todos:t.todos,onClose:()=>n(!1)})}),(0,r.jsx)(u,{isOpen:a,onClose:()=>i(!1),onSubmit:D,onDelete:L,initialData:{id:t.id,title:t.title,date:t.date,type:t.type,description:t.description||""}})]})}function g(){let{nodes:e,loading:t,error:s,fetchNodes:l,startDate:n,endDate:i}=d();return((0,o.useEffect)(()=>{l()},[l]),t)?(0,r.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,r.jsx)("div",{className:"text-lg text-gray-600",children:"加载中..."})}):s?(0,r.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,r.jsx)("div",{className:"text-lg text-red-600",children:s})}):(0,r.jsxs)("div",{className:"relative min-h-[400px] w-full rounded-lg bg-white shadow-sm",children:[(0,r.jsx)("div",{className:"absolute left-0 right-0 top-1/2 h-0.5 bg-gray-300"}),(()=>{let e=[],t=a()(n),s=a()(i).diff(t,"day"),o=1;s>60?o=7:s>30&&(o=3);for(let l=0;l<=s;l+=o){let o=t.add(l,"day"),n=l/s*100;e.push((0,r.jsxs)("div",{className:"absolute",style:{left:"".concat(n,"%"),top:"50%"},children:[(0,r.jsx)("div",{className:"h-1 w-0.5 bg-gray-400 mx-auto -mt-1"}),(0,r.jsx)("div",{className:"text-xs text-gray-500 -translate-x-1/2 whitespace-nowrap mt-1",children:o.format("MM/DD")})]},"marker-".concat(l)))}return e})(),e.map((e,t)=>(0,r.jsx)(x,{node:e,position:function(e,t,s){let r=a()(e),o=a()(t),l=a()(s).diff(o);return r.diff(o)/l*100}(e.date,n,i)},e.id||"node-".concat(t,"-").concat(e.date,"-").concat(e.title)))]})}function h(){let[e,t]=(0,o.useState)(!1),{addNode:s,setDateRange:l,startDate:n,endDate:i,loadSettings:c}=d();(0,o.useEffect)(()=>{c()},[c]);let m=async e=>{try{let r={id:Date.now().toString(),...e,todos:[],titleOffset:{x:0,y:0}};await s(r),t(!1)}catch(e){console.error("Failed to add node:",e)}},x=async e=>{let t=new Date(e.target.value);await l(t,i)},g=async e=>{let t=new Date(e.target.value);await l(n,t)},h=e=>a()(e).format("YYYY-MM-DD");return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("button",{onClick:()=>t(!0),className:"rounded bg-blue-500 px-4 py-2 text-white hover:bg-blue-600",children:"添加节点"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-900",children:"开始日期:"}),(0,r.jsx)("input",{type:"date",value:h(n),onChange:x,className:"rounded border border-gray-300 p-1 text-sm text-gray-900"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-gray-900",children:"结束日期:"}),(0,r.jsx)("input",{type:"date",value:h(i),onChange:g,className:"rounded border border-gray-300 p-1 text-sm text-gray-900"})]})]}),(0,r.jsx)(u,{isOpen:e,onClose:()=>t(!1),onSubmit:m,onDelete:()=>{},initialData:{title:"新节点",date:new Date().toISOString(),type:"normal",description:""}})]})}function f(){let{nodes:e}=d(),[t,s]=(0,o.useState)(null),l=e.flatMap(e=>e.todos),n=l.filter(e=>e.completed),a=l.filter(e=>!e.completed),i=l.length?n.length/l.length*100:0;return(0,r.jsxs)("div",{className:"mt-6 rounded-lg bg-white p-4 shadow-sm",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"项目总进度"}),(0,r.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[Math.round(i),"%"]})]}),(0,r.jsx)("div",{className:"h-2 overflow-hidden rounded-full bg-gray-200",children:(0,r.jsx)("div",{className:"h-full ".concat(i<30?"bg-red-500":i<100?"bg-yellow-500":"bg-green-500"," transition-all duration-500"),style:{width:"".concat(i,"%")}})}),(0,r.jsxs)("div",{className:"mt-4 grid grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>s("all"),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:"总任务数"}),(0,r.jsx)("div",{className:"mt-1 text-2xl font-semibold text-gray-900",children:l.length})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>s("completed"),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:"已完成"}),(0,r.jsx)("div",{className:"mt-1 text-2xl font-semibold text-gray-900",children:n.length})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>s("uncompleted"),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:"未完成"}),(0,r.jsx)("div",{className:"mt-1 text-2xl font-semibold text-red-600",children:a.length})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-gray-50 p-3 cursor-pointer hover:bg-gray-100 transition-colors",onClick:()=>s("nodes"),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:"节点数"}),(0,r.jsx)("div",{className:"mt-1 text-2xl font-semibold text-gray-900",children:e.length})]})]}),t&&(()=>{let o=[],i="";switch(t){case"all":o=l,i="全部任务";break;case"completed":o=n,i="已完成任务";break;case"uncompleted":o=a,i="未完成任务";break;case"nodes":return(0,r.jsxs)("div",{className:"mt-4 rounded-lg bg-white p-4 shadow-sm",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"所有节点"}),(0,r.jsx)("button",{onClick:()=>s(null),className:"text-gray-900 hover:text-gray-700",children:"\xd7"})]}),(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,r.jsx)("li",{className:"py-2",children:(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-900",children:e.title}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-900",children:e.date.split("T")[0]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-900",children:[e.todos.filter(e=>e.completed).length,"/",e.todos.length," 已完成"]})]})},e.id))})]});default:return null}return(0,r.jsxs)("div",{className:"mt-4 rounded-lg bg-white p-4 shadow-sm",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:i}),(0,r.jsx)("button",{onClick:()=>s(null),className:"text-gray-900 hover:text-gray-700",children:"\xd7"})]}),(0,r.jsx)("ul",{className:"divide-y divide-gray-200",children:o.length>0?o.map(t=>{var s;return(0,r.jsx)("li",{className:"py-2",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"mr-2 h-3 w-3 rounded-full ".concat(t.completed?"bg-green-500":"bg-red-500")}),(0,r.jsx)("span",{className:t.completed?"text-gray-400 line-through":"text-gray-900",children:t.text}),(0,r.jsx)("span",{className:"ml-2 text-xs text-gray-900",children:(null===(s=e.find(e=>e.id===t.nodeId))||void 0===s?void 0:s.title)||"未知节点"})]})},t.id)}):(0,r.jsx)("li",{className:"py-4 text-center text-gray-900",children:"没有任务"})})]})})()]})}function p(){return(0,r.jsx)("main",{className:"min-h-screen bg-gray-50 p-8",children:(0,r.jsxs)("div",{className:"mx-auto max-w-7xl space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"时间线"}),(0,r.jsx)(h,{}),(0,r.jsx)(g,{}),(0,r.jsx)(f,{})]})})}},9351:(e,t,s)=>{Promise.resolve().then(s.bind(s,4022))}},e=>{var t=t=>e(e.s=t);e.O(0,[101,441,684,358],()=>t(9351)),_N_E=e.O()}]);